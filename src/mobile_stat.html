<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Vehicle Search</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/fab-tabs.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard_theme_arrows.min.css"
        rel="stylesheet" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/jquery.smartWizard.min.js"></script>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">ExoMexo</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="search.html">Search</a></li>
                <li class="nav-item"><a class="nav-link" href="statistic.html">Statistics</a></li>
                <li class="nav-item"><a class="nav-link" href="price_calculator.html">Price Calculator</a></li>
            </ul>
        </div>
    </nav>

    <div class="container mt-4">
        <h2 class="text-center">Data Analysis</h2>
        <div class="tabs">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="search-tab" data-toggle="tab" href="#search" role="tab"
                        aria-controls="search" aria-selected="true">Search</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="grouping-tab" data-toggle="tab" href="#grouping" role="tab"
                        aria-controls="grouping" aria-selected="false">Grouping</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="statistics-tab" data-toggle="tab" href="#statistics" role="tab"
                        aria-controls="statistics" aria-selected="false">Data Insights</a>
                </li>
            </ul>
            <div class="tab-content" id="myTabContent">
                <!-- Search Tab -->
                <div class="tab-pane fade show active" id="search" role="tabpanel" aria-labelledby="search-tab">
                    <h5>Search Criteria <button id="toggleAdvancedSearch"
                            class="btn btn-outline-secondary btn-sm">Advanced</button></h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="make">Make</label>
                            <select id="make" class="form-control">
                                <option value="">Select Make</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="model">Model</label>
                            <select id="model" class="form-control">
                                <option value="">Select Model</option>
                            </select>
                        </div>
                        <div class="mt-3 row">
                            <div class="col-md-12 mb-3">
                                <label>Engine:</label>
                                <div id="engine" class="custom-checkbox-grid"></div>
                            </div>
                        </div>
                    </div>
                    <div id="basicSearch" style="display: block;">
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="basicSearchYearFrom">Production Year</label>
                                <select id="basicSearchYearFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="basicSearchPriceTo">Max Price</label>
                                <select id="basicSearchPriceTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="basicSearchMileageTo">Mileage</label>
                                <select id="basicSearchMileageTo" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="basicSearchPowerFrom">Power</label>
                                <select id="basicSearchPowerFrom" class="form-control"></select>
                            </div>
                        </div>

                    </div>
                    <div id="advancedSearch" style="display: none;">
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchGearbox">Gearbox</label>
                                <select id="advancedSearchGearbox" class="form-control">
                                    <option value="">Select Gearbox</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchYearFrom">Year</label>
                                <select id="advancedSearchYearFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchYearTo">Year</label>
                                <select id="advancedSearchYearTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchMileageFrom">Mileage</label>
                                <select id="advancedSearchMileageFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchMileageTo">Mileage</label>
                                <select id="advancedSearchMileageTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchPowerFrom">Power</label>
                                <select id="advancedSearchPowerFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchPowerTo">Power</label>
                                <select id="advancedSearchPowerTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchCcFrom">cm³</label>
                                <select id="advancedSearchCcFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="advancedSearchCcTo">cm³</label>
                                <select id="advancedSearchCcTo" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                    <div class="grouping-section">
                        <div class="description">
                            <p>Select fields to group vehicles data by:</p>
                        </div>
                        <div class="form-group row">
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByMake" checked>
                                <label class="form-check-label" for="groupByMake">Make</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByModel">
                                <label class="form-check-label" for="groupByModel">Model</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByYear">
                                <label class="form-check-label" for="groupByYear">Year</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByEngine">
                                <label class="form-check-label" for="groupByEngine">Engine</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByGearbox">
                                <label class="form-check-label" for="groupByGearbox">Gearbox</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByMileage">
                                <label class="form-check-label" for="groupByMileage">Mileage</label>
                            </div>
                            <div class="col-6 form-check">
                                <input type="checkbox" class="form-check-input" id="groupByPower">
                                <label class="form-check-label" for="groupByPower">Power</label>
                            </div>
                        </div>

                        <!-- Info Icon for Help Text -->
                        <div class="info-icon">
                            <i class="fas fa-info-circle" data-toggle="modal" data-target="#helpModal"></i>
                        </div>
                    </div>
                    <!-- Bootstrap Modal -->
                    <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="helpModalLabel">Grouping and Statistics Help</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p><strong>Understanding Grouping and Statistics:</strong></p>
                                    <p>Selecting the checkboxes above allows you to group the vehicles based on the
                                        selected criteria. For example, you can group the vehicles by their make, model,
                                        or year of manufacture. This helps you to organize the data and see trends and
                                        patterns more clearly.</p>
                                    <p>Specifically for mileage, the vehicles will be grouped into the following
                                        categories:</p>
                                    <ul>
                                        <li>Up to 20,000 km.</li>
                                        <li>20,000 - 40,000 km.</li>
                                        <li>40,000 - 60,000 km.</li>
                                        <li>60,000 - 80,000 km.</li>
                                        <li>80,000 - 100,000 km.</li>
                                        <li>100,000 - 120,000 km.</li>
                                        <li>120,000 - 150,000 km.</li>
                                        <li>Over 150,000 km.</li>
                                    </ul>
                                    <p>Checking the power checkbox, the vehicles will be grouped into the following
                                        categories:</p>
                                    <ul>
                                        <li>Up to 90 h.p.</li>
                                        <li>90 - 130 h.p.</li>
                                        <li>130 - 250 h.p.</li>
                                        <li>150 - 200 h.p.</li>
                                        <li>200 - 252 h.p.</li>
                                        <li>252 - 303 h.p.</li>
                                        <li>303 - 358 h.p.</li>
                                        <li>358 - 403 h.p.</li>
                                        <li>403 - 454 h.p.</li>
                                        <li>Over 454 h.p.</li>
                                    </ul>
                                    <p>By grouping vehicles in this way, you can get a statistical overview for each
                                        group, such as:</p>
                                    <ul>
                                        <li><strong>Count:</strong> The total number of vehicles in each group.</li>
                                        <li><strong>Average:</strong> The average value of a certain attribute (e.g.,
                                            price) within each group.</li>
                                        <li><strong>Minimum and Maximum:</strong> The lowest and highest values within
                                            each group.</li>
                                    </ul>
                                    <p>This statistical overview helps you understand the characteristics of vehicles in
                                        each category, making it easier to analyze and make informed decisions.</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div> <!-- Hidden Help Text (initially hidden, shown on hover or click) -->


                </div>
                <!-- Grouping Tab -->
                <div class="tab-pane fade" id="grouping" role="tabpanel" aria-labelledby="grouping-tab">

                </div>
                <!-- Statistics Tab -->
                <div class="tab-pane fade" id="statistics" role="tabpanel" aria-labelledby="statistics-tab">
                    <div class="description">
                        <p><strong>Step 3: Select Columns and Statistical Functions</strong></p>
                        <p>
                            In this step, you will select the columns you want to analyze and the statistical
                            functions you want to apply to those columns.
                        </p>
                    </div>
                    <div class="description">
                        <p><strong>Select Columns to Analyze:</strong> Choose one or more columns from your dataset
                            that you wish to analyze. Each checkbox represents a different column. For example, you
                            might want to analyze the `Price` or `Estimated Price` columns to understand their
                            distribution and summary statistics. <strong>All prices are in EUR(&euro;). [Discount] and
                                [Increase] columns are percentages (for example 25%). </strong>
                        </p>
                    </div>
                    <div class="mt-3 row">
                        <div class="col-md-12 mb-3">
                            <div class="checkbox-container">
                                <input type="radio" class="column-check-input" name="statColumn" id="price_in_eur"
                                    value="price_in_eur" checked>
                                <label for="price_in_eur">Price</label>
                                <input type="radio" class="column-check-input" name="statColumn"
                                    id="estimated_price_in_eur" value="estimated_price_in_eur">
                                <label for="estimated_price_in_eur">Estimated Price</label>
                                <input type="radio" class="column-check-input" name="statColumn" id="save_diff_in_eur"
                                    value="save_diff_in_eur">
                                <label for="save_diff_in_eur">📉⬇️ Save Difference &euro;</label>
                                <input type="radio" class="column-check-input" name="statColumn"
                                    id="extra_charge_in_eur" value="extra_charge_in_eur">
                                <label for="extra_charge_in_eur">📈🔺 Extra Charge &euro;</label>
                                <input type="radio" class="column-check-input" name="statColumn" id="discount"
                                    value="discount">
                                <label for="discount">📉⬇️ Discount %</label>
                                <input type="radio" class="column-check-input" name="statColumn" id="increase"
                                    value="increase">
                                <label for="increase">📈🔺 Increased %</label>
                            </div>
                        </div>
                    </div>
                    <div class="description">
                        <p><strong>Select Statistical Functions to Apply:</strong> Choose the statistical functions
                            you want to apply to the selected columns. These functions will help you summarize and
                            understand the data better.</p>
                    </div>
                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="statCount" checked>
                            <label class="form-check-label" for="statCount">Count</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="statAvg" checked>
                            <label class="form-check-label" for="statAvg">Average (Mean)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="statMedian">
                            <label class="form-check-label" for="statMedian">Median</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="std">
                            <label class="form-check-label" for="std">Standard Deviation</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="rsd">
                            <label class="form-check-label" for="rsd">Relative Standard Deviation</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="statFrom">
                            <label class="form-check-label" for="statFrom">Min</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="statTo">
                            <label class="form-check-label" for="statTo">Max</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_60">
                            <label class="form-check-label" for="quantile_60">Percentile (60%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_66">
                            <label class="form-check-label" for="quantile_66">Percentile (66%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_70">
                            <label class="form-check-label" for="quantile_70">Percentile (70%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_75">
                            <label class="form-check-label" for="quantile_75">Percentile (75%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_80">
                            <label class="form-check-label" for="quantile_80">Percentile (80%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="quantile_90">
                            <label class="form-check-label" for="quantile_90">Percentile (90%)</label>
                        </div>
                    </div>
                    <div class="description">
                        <p><strong>Statistical Functions Description:</strong></p>
                        <ul>
                            <li><strong>Count:</strong> Total number of data points in the selected column.</li>
                            <li><strong>Min:</strong> The smallest value in the selected column.</li>
                            <li><strong>Max:</strong> The largest value in the selected column.</li>
                            <li><strong>Average (Mean):</strong> The sum of all values divided by the number of
                                values in the selected column.</li>
                            <li><strong>Median:</strong> The middle value when the selected column's values are
                                ordered from smallest to largest.</li>
                            <li><strong>Standard Deviation:</strong> A measure of how spread out the values in the
                                selected column are around the mean.</li>
                            <li><strong>Relative Standard Deviation (RSD):</strong> The standard deviation expressed
                                as a percentage of the mean, indicating the extent of variability in relation to the
                                mean.</li>
                            <li><strong>Percentiles:</strong> Values below which a certain percentage of the data in
                                the selected column falls. For example, the 60th percentile is the value below which
                                60% of the data falls.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" data-toggle="modal" data-target="#summaryModal">
            <i class="fas fa-list-alt"></i> Summary
        </button>
    </div>

    <!-- Summary Modal -->
    <div class="modal fade" id="summaryModal" tabindex="-1" role="dialog" aria-labelledby="summaryModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="summaryModalLabel">Search Summary</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Summary content goes here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">Confirm and Search</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script type="module">
        import { fetchModels, clearModels, generateRequestData, captureData, validateJSON, populateMakesDropdown, populateDropdown, populateCheckboxes } from './scripts/statistic.js';
        import { showStatisticData } from './scripts/rainbow.js';
        const isLocalhost = window.location.hostname === 'localhost';

        // Set the base URL based on the environment
        const baseUrl = isLocalhost ? 'https://localhost:3000' : 'https://ehomeho.com:3000';

        let map = new Map();
        map.set('make', 'make');

        map.set('basicSearchYearFrom', 'year');
        map.set('basicSearchPriceTo', 'price');
        map.set('basicSearchMileageTo', 'mileage');
        map.set('basicSearchPowerFrom', 'power');

        map.set('engine', 'engine');
        map.set('advancedSearchYearFrom', 'year');
        map.set('advancedSearchYearTo', 'year');

        map.set('advancedSearchMileageFrom', 'mileage');
        map.set('advancedSearchMileageTo', 'mileage');

        map.set('advancedSearchPowerFrom', 'power');
        map.set('advancedSearchPowerTo', 'power');
        map.set('advancedSearchCcFrom', 'cc');
        map.set('advancedSearchCcTo', 'cc');
        map.set('advancedSearchGearbox', 'gearbox');
        map.set('advancedSearchPriceFrom', 'price');
        map.set('advancedSearchPriceTo', 'price');


        map.forEach((enumName, elementId) => {
            populateFilters(enumName, elementId);
        });

        localStorage.clear();
        function redirectToResultsPage(requestData) {
            console.log("Local storage data:", requestData);
            localStorage.setItem('requestData', JSON.stringify(requestData));
            const columns = [];

            const groupByFields = requestData.group;
            groupByFields.forEach(groupByField => {
                columns.push({ value: groupByField, text: groupByField });
            });

            const stat_column = requestData.stat_column;
            const aggregators = requestData.aggregators;
            aggregators.forEach(aggregator => {
                columns.push({ value: `${stat_column}_${aggregator}`, text: `${aggregator}` });
            });


            localStorage.setItem('columns', JSON.stringify(columns));
            localStorage.setItem('type', 'statistic');
            window.location.href = `results.html`;
        }

        document.addEventListener('DOMContentLoaded', () => {

            document.getElementById('make').addEventListener('change', function () {
                const selectedMake = this.value;
                if (selectedMake) {
                    fetchModels(selectedMake);
                } else {
                    clearModels();
                }
            });
        });
        document.getElementById('toggleAdvancedSearch').addEventListener('click', function () {
            const advancedFields = document.getElementById('advancedSearch');
            const basicFields = document.getElementById('basicSearch');
            advancedFields.style.display = advancedFields.style.display === 'none' ? 'block' : 'none';
            basicFields.style.display = basicFields.style.display === 'none' ? 'block' : 'none';
            this.textContent = advancedFields.style.display === 'none' ? 'Advanced' : 'Basic';

        });

        // Initialize tooltips (if help icons are added later)
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        });
        // Show help text on hover or click
        document.querySelector('.info-icon').addEventListener('click', function () {
            const description = document.querySelector('.description');
            description.style.display = description.style.display === 'none' ? 'block' : 'none';
        });


        function populateFilters(enumName, elementId) {
            fetch(`${baseUrl}/enums/${enumName}?source = estimated_price`, {
                headers: {
                    'Accept': 'application/json',
                    'Access-Control-Allow-Origin': '*'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if ('engine' === elementId) {
                        populateCheckboxes(data, elementId);
                    } else if ('gearbox' === elementId) {
                        populateDropdown(data, '', elementId);
                    } else if (elementId === 'make') {
                        populateMakesDropdown();
                    } else {
                        populateDropdown(data, '', elementId);
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>

</html>
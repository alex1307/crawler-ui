<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Vehicle Statistics</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles/stat.css">
    <link rel="stylesheet" href="styles/searchstyles.css">
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard.min.css" rel="stylesheet"
        type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/smart_wizard_theme_arrows.min.css"
        rel="stylesheet" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/bbbootstrap/libraries@main/jquery.smartWizard.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .navbar {
            background-color: #343a40;
            width: 100%;
        }

        .navbar-brand,
        .navbar-nav .nav-link {
            color: #ffffff;
        }

        .navbar-brand:hover,
        .navbar-nav .nav-link:hover {
            color: #d4d4d4;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .footer {
            padding: 10px 0;
            text-align: center;
            background-color: #343a40;
            color: #ffffff;
            width: 100%;
        }

        .footer a {
            color: #ffffff;
            margin: 0 10px;
            text-decoration: none;
        }

        .footer a:hover {
            color: #d4d4d4;
        }

        .bcontent {
            margin-top: 10px;
        }

        /* Style for the "Next" button */
        .btn-toolbar .sw-btn-next {
            background: linear-gradient(135deg, #6a11cb, #2575fc) !important;
            /* Gradient */
            border: none !important;
            color: white !important;
            border-radius: 25px !important;
            padding: 10px 30px !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
        }

        .btn-toolbar .sw-btn-next:hover {
            background: linear-gradient(135deg, #2575fc, #6a11cb) !important;
            /* Gradient reverse */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }

        /* Style for the "Previous" button */
        .btn-toolbar .sw-btn-prev {
            background: linear-gradient(135deg, #f7971e, #ffd200) !important;
            /* Gradient */
            border: none !important;
            color: white !important;
            border-radius: 25px !important;
            padding: 10px 30px !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
        }

        .btn-toolbar .sw-btn-prev:hover {
            background: linear-gradient(135deg, #ffd200, #f7971e) !important;
            /* Gradient reverse */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }

        /* Style for the "Search" button inside step-5 */
        #step-5 .btn-primary.sw-btn-search {
            background: linear-gradient(135deg, #28a745, #4caf50) !important;
            /* Green */
            border: none !important;
            color: white !important;
            border-radius: 25px !important;
            padding: 10px 30px !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
            transition: all 0.3s ease !important;
        }

        #step-5 .btn-primary.sw-btn-search:hover {
            background: linear-gradient(135deg, #4caf50, #28a745) !important;
            /* Gradient reverse */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }

        /* Additional button styling */
        .btn-toolbar .sw-btn,
        #step-5 .btn-primary.sw-btn-search {
            border-radius: 25px !important;
            padding: 10px 30px !important;
        }

        /* Style for the step tabs */
        .smartwizard .nav-tabs {
            border-bottom: none;
        }

        .smartwizard .nav-link {
            border-radius: 25px !important;
            background: linear-gradient(135deg, #f7971e, #ffd200) !important;
            /* Previous button color */
            border: none !important;
            color: white !important;
            margin: 0 5px;
            transition: all 0.3s ease !important;
        }

        .smartwizard .nav-link:hover {
            background: linear-gradient(135deg, #ffd200, #f7971e) !important;
            /* Gradient reverse */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }

        .smartwizard .nav-link.done {
            background: linear-gradient(135deg, #6a11cb, #2575fc) !important;
            /* Next button color */
        }

        .smartwizard .nav-link.active {
            background: linear-gradient(135deg, #28a745, #4caf50) !important;
            /* Green */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="#">KatMaXüòªü¶Åüê∏</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="search.html">Search</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="statistic.html">Statistics</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-4 content">
        <h2>Vehicle Price Calculator</h2>
        <form id="calculatorForm" class="search-form">
            <div id="smartwizard">
                <ul>
                    <li><a href="#step-1">Step 1<br /><small>Vehicle Filter</small></a></li>
                    <li><a href="#step-2">Step 2<br /><small>Group By Fields</small></a></li>
                    <li><a href="#step-3">Step 3<br /><small>Statistics</small></a></li>
                    <li><a href="#step-4">Step 4<br /><small>Order Results</small></a></li>
                    <li><a href="#step-5">Step 5<br /><small>Validate and Search</small></a></li>
                </ul>
                <div class="mt-5">
                    <!-- Step 1: Vehicle Filter -->
                    <div id="step-1" class="tab-pane" role="tabpanel">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="make">Make</label>
                                <select id="make" class="form-control">
                                    <option value="">Select Make</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="model">Model</label>
                                <select id="model" class="form-control">
                                    <option value="">Select Model</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-3 row">
                            <div class="col-md-12 mb-3">
                                <label>Engine:</label>
                                <div id="engine" class="custom-checkbox-grid"></div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="gearbox">Gearbox</label>
                                <select id="gearbox" class="form-control">
                                    <option value="">Select Gearbox</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="yearFrom">Year</label>
                                <select id="yearFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="yearTo">Year</label>
                                <select id="yearTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="mileageFrom">Mileage</label>
                                <select id="mileageFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="mileageTo">Mileage</label>
                                <select id="mileageTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="powerFrom">Power</label>
                                <select id="powerFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="powerTo">Power</label>
                                <select id="powerTo" class="form-control"></select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="ccFrom">cm¬≥</label>
                                <select id="ccFrom" class="form-control"></select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="ccTo">cm¬≥</label>
                                <select id="ccTo" class="form-control"></select>
                            </div>
                        </div>
                    </div>
                    <!-- Step 2: Group By Fields -->
                    <div id="step-2" class="tab-pane" role="tabpanel">
                        <div class="description">
                            <p>Select fields to group vehicles:</p>
                        </div>
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByMake">
                                <label class="form-check-label" for="groupByMake">Make</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByModel">
                                <label class="form-check-label" for="groupByModel">Model</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByYear">
                                <label class="form-check-label" for="groupByYear">Year</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByEngine">
                                <label class="form-check-label" for="groupByEngine">Engine</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByGearbox">
                                <label class="form-check-label" for="groupByGearbox">Gearbox</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByMileage">
                                <label class="form-check-label" for="groupByMileage">Mileage</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="groupByPower">
                                <label class="form-check-label" for="groupByPower">Power</label>
                            </div>
                        </div>
                        <div class="description">
                            <p><strong>Understanding Grouping and Statistics:</strong></p>
                            <p>Selecting the checkboxes above allows you to group the vehicles based on the selected
                                criteria. For example, you can group the vehicles by their make, model, or year of
                                manufacture. This helps you to organize the data and see trends and patterns more
                                clearly.</p>
                            <p>Specifically for mileage, the vehicles will be grouped into the following categories:
                            <ul>
                                <li>Up to 20,000 km.</li>
                                <li>20,000 - 40,000 km.</li>
                                <li>40,000 - 60,000 km.</li>
                                <li>60,000 - 80,000 km.</li>
                                <li>80,000 - 100,000 km.</li>
                                <li>100,000 - 120,000 km.</li>
                                <li>120,000 - 150,000 km.</li>
                                <li>Over 150,000 km.</li>
                            </ul>
                            </p>

                            <p>Checkiong power checkbox, the vehicles will be
                                grouped into the following categories:
                            <ul>
                                <li>Up to 90 h.p.</li>
                                <li>90 - 130 h.p. </li>
                                <li>130 - 250 h.p. </li>
                                <li>150 - 200 h.p. </li>
                                <li>200 - 252 h.p.</li>
                                <li>252 - 303 h.p.</li>
                                <li>303 - 358 h.p.</li>
                                <li>358 - 403 h.p.</li>
                                <li>403 - 454 h.p.</li>
                                <li>Over 454 h.p.</li>
                            </ul>
                            </p>

                            <p>By grouping vehicles in this way, you can get a
                                statistical overview for each group, such as:
                            <ul>
                                <li><strong>Count:</strong> The total number of
                                    vehicles in each group.</li>
                                <li><strong>Average:</strong> The average value of a
                                    certain attribute (e.g., price) within each
                                    group.</li>
                                <li><strong>Minimum and Maximum:</strong> The lowest
                                    and highest values within each group.</li>
                            </ul>
                            This statistical overview helps you understand the
                            characteristics of vehicles in each category, making it
                            easier to analyze and make informed decisions.</p>
                        </div>
                    </div>

                    <!-- Step 3: Statistics -->
                    <div id="step-3" class="tab-pane" role="tabpanel">
                        <div class="description">
                            <p><strong>Step 3: Select Columns and Statistical Functions</strong></p>
                            <p>In this step, you will select the columns you want to analyze and the statistical
                                functions you want to apply to those columns.</p>
                        </div>
                        <div class="description">
                            <p><strong>Select Columns to Analyze:</strong> Choose one or more columns from your dataset
                                that you wish to analyze. Each checkbox represents a different column. For example, you
                                might want to analyze the 'Price' or 'Estimated Price' columns to understand their
                                distribution and summary statistics. <strong>All prices are in EUR(‚Ç¨). [Discount] and
                                    [Increase] columns are percentages (for example 25%).</strong></p>
                        </div>
                        <div class="mt-3 row">
                            <div class="col-md-12 mb-3">
                                <div class="checkbox-container">
                                    <input type="radio" class="column-check-input" name="statColumn" id="price_in_eur"
                                        value="price_in_eur" checked>
                                    <label for="price_in_eur">Price</label>
                                    <input type="radio" class="column-check-input" name="statColumn"
                                        id="estimated_price_in_eur" value="estimated_price_in_eur">
                                    <label for="estimated_price_in_eur">Estimated Price</label>
                                    <input type="radio" class="column-check-input" name="statColumn"
                                        id="save_diff_in_eur" value="save_diff_in_eur">
                                    <label for="save_diff_in_eur">üìâ‚¨áÔ∏è Save Difference ‚Ç¨</label>
                                    <input type="radio" class="column-check-input" name="statColumn"
                                        id="extra_charge_in_eur" value="extra_charge_in_eur">
                                    <label for="extra_charge_in_eur">üìàüî∫ Extra Charge ‚Ç¨</label>
                                    <input type="radio" class="column-check-input" name="statColumn" id="discount"
                                        value="discount">
                                    <label for="discount">üìâ‚¨áÔ∏è Discount %</label>
                                    <input type="radio" class="column-check-input" name="statColumn" id="increase"
                                        value="increase">
                                    <label for="increase">üìàüî∫ Increased %</label>
                                </div>
                            </div>
                        </div>
                        <div class="description">
                            <p><strong>Select Statistical Functions to Apply:</strong> Choose the statistical functions
                                you want to apply to the selected columns. These functions will help you summarize and
                                understand the data better.</p>
                        </div>
                        <div class="form-group">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="statCount" checked>
                                <label class="form-check-label" for="statCount">Count</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="statAvg" checked>
                                <label class="form-check-label" for="statAvg">Average (Mean)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="statMedian">
                                <label class="form-check-label" for="statMedian">Median</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="std">
                                <label class="form-check-label" for="std">Standard Deviation</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="rsd">
                                <label class="form-check-label" for="rsd">Relative Standard Deviation</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="statFrom">
                                <label class="form-check-label" for="statFrom">Min</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="statTo">
                                <label class="form-check-label" for="statTo">Max</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_60">
                                <label class="form-check-label" for="quantile_60">Percentile (60%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_66">
                                <label class="form-check-label" for="quantile_66">Percentile (66%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_70">
                                <label class="form-check-label" for="quantile_70">Percentile (70%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_75">
                                <label class="form-check-label" for="quantile_75">Percentile (75%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_80">
                                <label class="form-check-label" for="quantile_80">Percentile (80%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="quantile_90">
                                <label class="form-check-label" for="quantile_90">Percentile (90%)</label>
                            </div>
                        </div>
                        <div class="description">
                            <p><strong>Statistical Functions Description:</strong></p>
                            <ul>
                                <li><strong>Count:</strong> Total number of data points in the selected column.</li>
                                <li><strong>Min:</strong> The smallest value in the selected column.</li>
                                <li><strong>Max:</strong> The largest value in the selected column.</li>
                                <li><strong>Average (Mean):</strong> The sum of all values divided by the number of
                                    values in the selected column.</li>
                                <li><strong>Median:</strong> The middle value when the selected column's values are
                                    ordered from smallest to largest.</li>
                                <li><strong>Standard Deviation:</strong> A measure of how spread out the values in the
                                    selected column are around the mean.</li>
                                <li><strong>Relative Standard Deviation (RSD):</strong> The standard deviation expressed
                                    as a percentage of the mean, indicating the extent of variability in relation to the
                                    mean.</li>
                                <li><strong>Percentiles:</strong> Values below which a certain percentage of the data in
                                    the selected column falls. For example, the 60th percentile is the value below which
                                    60% of the data falls.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Step 4: Order Results -->
                    <div id="step-4" class="tab-pane" role="tabpanel">
                        <div class="description">
                            <p>Select fields to order vehicles:</p>
                        </div>
                        <div class="form-group">
                            <label for="orderColumn1">Select first column to order by:</label>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <select id="orderColumn1" class="form-control">
                                        <option value="">Please select</option>
                                        <option value="make">Make</option>
                                        <option value="model">Model</option>
                                        <option value="year">Year</option>
                                        <option value="engine">Engine</option>
                                        <option value="gearbox">Gearbox</option>
                                        <option value="power">Power</option>
                                        <option value="mileage">Mileage</option>
                                        <option value="cc">CC</option>
                                        <option value="estimated_price">Estimated Price</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="radio-inline">
                                        <input type="radio" name="order1" value="asc" checked> Ascending
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="order1" value="desc"> Descending
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="orderColumn2">Select second column to order by:</label>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <select id="orderColumn2" class="form-control">
                                        <option value="">Please select</option>
                                        <option value="make">Make</option>
                                        <option value="model">Model</option>
                                        <option value="year">Year</option>
                                        <option value="engine">Engine</option>
                                        <option value="gearbox">Gearbox</option>
                                        <option value="power">Power</option>
                                        <option value="mileage">Mileage</option>
                                        <option value="cc">CC</option>
                                        <option value="estimated_price">Estimated Price</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="radio-inline">
                                        <input type="radio" name="order2" value="asc" checked> Ascending
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="order2" value="desc"> Descending
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="orderColumn3">Select third column to order by:</label>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <select id="orderColumn3" class="form-control">
                                        <option value="">Please select</option>
                                        <option value="make">Make</option>
                                        <option value="model">Model</option>
                                        <option value="year">Year</option>
                                        <option value="engine">Engine</option>
                                        <option value="gearbox">Gearbox</option>
                                        <option value="power">Power</option>
                                        <option value="mileage">Mileage</option>
                                        <option value="cc">CC</option>
                                        <option value="estimated_price">Estimated Price</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="radio-inline">
                                        <input type="radio" name="order3" value="asc" checked> Ascending
                                    </label>
                                    <label class="radio-inline">
                                        <input type="radio" name="order3" value="desc"> Descending
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Confirm Details -->
                    <div id="step-5" class="tab-pane step-content" role="tabpanel">
                        <div id="errors" class="description"></div>
                    </div>
                </div>
            </div>
        </form>
        <div class="content mt-4" id="results"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>&copy; 2024 KatMaXüòªü¶Åüê∏</p>
        <p>
            <a href="index.html">Home</a> |
            <a href="search.html">Search</a> |
            <a href="statistic.html">Statistics</a>
        </p>
    </div>

    <script type="module">
        import { populateFilter, fetchModels, clearModels, generateRequestData, captureData, validateJSON } from './scripts/statistic.js';
        import { showStatisticData } from './scripts/rainbow.js';
        localStorage.clear();
        function redirectToResultsPage(requestData) {
            console.log("Local storage data:", requestData);
            localStorage.setItem('requestData', JSON.stringify(requestData));
            const columns = [];

            const groupByFields = requestData.group;
            groupByFields.forEach(groupByField => {
                columns.push({ value: groupByField, text: groupByField });
            });

            const stat_column = requestData.stat_column;
            const aggregators = requestData.aggregators;
            aggregators.forEach(aggregator => {
                columns.push({ value: `${stat_column}_${aggregator}`, text: `${aggregator}` });
            });


            localStorage.setItem('columns', JSON.stringify(columns));
            localStorage.setItem('type', 'statistic');
            window.location.href = `results.html`;
        }

        $(document).ready(function () {
            const filters = ['price', 'power', 'mileage', 'cc', 'make', 'engine', 'gearbox', 'year', 'mileage_status'];
            filters.forEach(filter => populateFilter(filter));

            $('#smartwizard').smartWizard({
                theme: 'arrows',
                transitionEffect: 'fade',
                toolbarSettings: {
                    toolbarPosition: 'bottom',
                    toolbarButtonPosition: 'right',
                    showNextButton: true,
                    showPreviousButton: true
                }
            });
        });

        $('#smartwizard').on("showStep", function (e, anchorObject, stepNumber, stepDirection) {
            console.log("showStep");
            // Show the search button only on the last step
            if (stepNumber === 4) { // Assuming stepNumber 4 corresponds to Step 5
                console.log("final step #5");
                const json = captureData();
                if (validateJSON(json)) {
                    console.log("Redirecting to results.html");
                    const data = JSON.parse(json);
                    console.log("DATA: ", data);// This function should collect your form data
                    redirectToResultsPage(data);
                } else {
                    return false;
                }
            }
            return true;
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('make').addEventListener('change', function () {
                const selectedMake = this.value;
                if (selectedMake) {
                    fetchModels(selectedMake);
                } else {
                    clearModels();
                }
            });
        });
    </script>
</body>

</html>